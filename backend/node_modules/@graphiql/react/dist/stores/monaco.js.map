{"version":3,"file":"monaco.js","sources":["../../src/stores/monaco.ts"],"sourcesContent":["import { createStore } from 'zustand';\nimport type { MonacoGraphQLAPI } from 'monaco-graphql';\nimport { createBoundedUseStore } from '../utility';\nimport {\n  JSON_DIAGNOSTIC_OPTIONS,\n  MONACO_GRAPHQL_DIAGNOSTIC_SETTINGS,\n  MONACO_THEME_NAME,\n  MONACO_THEME_DATA,\n} from '../constants';\n\ninterface MonacoStoreType {\n  monaco?: typeof import('monaco-editor');\n  monacoGraphQL?: MonacoGraphQLAPI;\n  actions: {\n    initialize: () => Promise<void>;\n  };\n}\n\n/**\n * Patch for Firefox compatibility:\n *\n * Fixes:\n *    Uncaught Error: can't access property \"offsetNode\", hitResult is null\n *\n * Related issues:\n * - https://github.com/graphql/graphiql/issues/4041\n * - https://github.com/microsoft/monaco-editor/issues/4679\n * - https://github.com/microsoft/monaco-editor/issues/4527\n *\n * The suggested patch https://github.com/microsoft/monaco-editor/issues/4679#issuecomment-2406284453\n * no longer works in Mozilla Firefox\n */\nasync function patchFirefox() {\n  const { MouseTargetFactory } = await import(\n    // @ts-expect-error -- no types\n    'monaco-editor/esm/vs/editor/browser/controller/mouseTarget.js'\n  );\n  const originalFn = MouseTargetFactory._doHitTestWithCaretPositionFromPoint;\n\n  MouseTargetFactory._doHitTestWithCaretPositionFromPoint = (\n    ...args: any[]\n  ) => {\n    const [ctx, coords] = args;\n    const hitResult = ctx.viewDomNode.ownerDocument.caretPositionFromPoint(\n      coords.clientX,\n      coords.clientY,\n    );\n    if (hitResult) {\n      // Delegate to the original function if hitResult is valid\n      const result = originalFn(...args);\n      return result;\n    }\n    // We must return an object with `type: 0` to avoid the following error:\n    // Uncaught Error: can't access property \"type\", result is undefined\n    return { type: 0 };\n  };\n}\n\n/**\n * Dynamically load `monaco-editor` and `monaco-graphql` in `useEffect` after component renders.\n *\n * **Do not convert these to static `import` statements.**\n * In SSR (e.g., Next.js), static imports run on the server\n * where `window` is undefined and trigger an error.\n */\nexport const monacoStore = createStore<MonacoStoreType>((set, get) => ({\n  actions: {\n    async initialize() {\n      const isInitialized = Boolean(get().monaco);\n      if (isInitialized) {\n        return;\n      }\n      const [monaco, { initializeMode }] = await Promise.all([\n        import('monaco-graphql/esm/monaco-editor.js'),\n        import('monaco-graphql/esm/lite.js'),\n      ]);\n      globalThis.__MONACO = monaco;\n      monaco.languages.json.jsonDefaults.setDiagnosticsOptions(\n        JSON_DIAGNOSTIC_OPTIONS,\n      );\n      monaco.editor.defineTheme(MONACO_THEME_NAME.dark, MONACO_THEME_DATA.dark);\n      monaco.editor.defineTheme(\n        MONACO_THEME_NAME.light,\n        MONACO_THEME_DATA.light,\n      );\n      if (navigator.userAgent.includes('Firefox/')) {\n        void patchFirefox();\n      }\n      const monacoGraphQL = initializeMode({\n        diagnosticSettings: MONACO_GRAPHQL_DIAGNOSTIC_SETTINGS,\n      });\n      set({ monaco, monacoGraphQL });\n    },\n  },\n}));\n\nexport const useMonaco = createBoundedUseStore(monacoStore);\n"],"names":["patchFirefox","MouseTargetFactory","originalFn","_doHitTestWithCaretPositionFromPoint","args","ctx","coords","hitResult","viewDomNode","ownerDocument","caretPositionFromPoint","clientX","clientY","result","type","monacoStore","createStore","set","get","actions","initialize","isInitialized","Boolean","monaco","initializeMode","Promise","all","globalThis","__MONACO","languages","json","jsonDefaults","setDiagnosticsOptions","JSON_DIAGNOSTIC_OPTIONS","editor","defineTheme","MONACO_THEME_NAME","dark","MONACO_THEME_DATA","light","navigator","userAgent","includes","monacoGraphQL","diagnosticSettings","MONACO_GRAPHQL_DIAGNOSTIC_SETTINGS","useMonaco","createBoundedUseStore"],"mappings":";;;AAgCA,eAAeA,eAAe;AACtB,QAAA;AAAA,IAAEC;AAAAA,EAAAA,IAAuB,MAAM;AAAA;AAAA,IAEnC;AAAA,EACF;AACA,QAAMC,aAAaD,mBAAmBE;AAEnBA,qBAAAA,uCAAuC,IACrDC,SACA;AACG,UAAA,CAACC,KAAKC,MAAM,IAAIF;AAChBG,UAAAA,YAAYF,IAAIG,YAAYC,cAAcC,uBAC9CJ,OAAOK,SACPL,OAAOM,OACT;AACA,QAAIL,WAAW;AAEPM,YAAAA,SAASX,WAAW,GAAGE,IAAI;AAC1BS,aAAAA;AAAAA,IAAAA;AAIF,WAAA;AAAA,MAAEC,MAAM;AAAA,IAAE;AAAA,EACnB;AACF;AASO,MAAMC,cAAcC,YAA6B,CAACC,KAAKC,SAAS;AAAA,EACrEC,SAAS;AAAA,IACP,MAAMC,aAAa;AACjB,YAAMC,gBAAgBC,QAAQJ,IAAI,EAAEK,MAAM;AAC1C,UAAIF,eAAe;AACjB;AAAA,MAAA;AAEF,YAAM,CAACE,QAAQ;AAAA,QAAEC;AAAAA,MAAAA,CAAgB,IAAI,MAAMC,QAAQC,IAAI,CACrD,OAAO,qCAAqC,GAC5C,OAAO,4BAA4B,CAAC,CACrC;AACDC,iBAAWC,WAAWL;AACtBA,aAAOM,UAAUC,KAAKC,aAAaC,sBACjCC,uBACF;AACAV,aAAOW,OAAOC,YAAYC,kBAAkBC,MAAMC,kBAAkBD,IAAI;AACxEd,aAAOW,OAAOC,YACZC,kBAAkBG,OAClBD,kBAAkBC,KACpB;AACA,UAAIC,UAAUC,UAAUC,SAAS,UAAU,GAAG;AAC5C,aAAK1C,aAAa;AAAA,MAAA;AAEpB,YAAM2C,gBAAgBnB,eAAe;AAAA,QACnCoB,oBAAoBC;AAAAA,MAAAA,CACrB;AACG,UAAA;AAAA,QAAEtB;AAAAA,QAAQoB;AAAAA,MAAAA,CAAe;AAAA,IAAA;AAAA,EAC/B;AAEJ,EAAE;AAEWG,MAAAA,YAAYC,sBAAsBhC,WAAW;"}