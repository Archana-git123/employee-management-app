{"version":3,"file":"plugin.js","sources":["../../src/stores/plugin.ts"],"sourcesContent":["import type { ComponentType } from 'react';\nimport type { StateCreator } from 'zustand';\nimport type { SlicesWithActions } from '../types';\nimport { STORAGE_KEY } from '../constants';\n\nexport interface GraphiQLPlugin {\n  /**\n   * A component that renders content into the plugin pane.\n   */\n  content: ComponentType;\n\n  /**\n   * A component that renders an icon that will be shown inside a button that\n   * toggles the plugin visibility.\n   */\n  icon: ComponentType;\n\n  /**\n   * The unique title of the plugin. If two plugins are present with the same\n   * title, the provider component will throw an error.\n   */\n  title: string;\n}\n\nexport interface PluginSlice {\n  /**\n   * A list of all current plugins, including the built-in ones (the doc\n   * explorer and the history).\n   * @default []\n   */\n  plugins: GraphiQLPlugin[];\n\n  /**\n   * The plugin which is currently visible.\n   */\n  visiblePlugin: GraphiQLPlugin | null;\n\n  /**\n   * The plugin which is used to display the reference documentation when selecting a type.\n   * Pass `null` to remove plugin.\n   */\n  referencePlugin?: GraphiQLPlugin | null;\n\n  /**\n   * Invoked when the visibility state of any plugin changes.\n   * @param visiblePlugin - The plugin object that is now visible. If no plugin\n   * is visible, the function will be invoked with `null`.\n   */\n  onTogglePluginVisibility?(visiblePlugin: GraphiQLPlugin | null): void;\n}\n\nexport interface PluginActions {\n  /**\n   * Defines the plugin which is currently visible.\n   * @param plugin - The plugin that should become visible. You can either pass\n   * the plugin object (has to be referentially equal to the one passed as\n   * prop) or the plugin title as string. If `null` is passed, no plugin will\n   * be visible.\n   */\n  setVisiblePlugin(plugin?: GraphiQLPlugin | string | null): void;\n\n  setPlugins(plugins: GraphiQLPlugin[]): void;\n}\n\nexport interface PluginProps\n  extends Pick<PluginSlice, 'referencePlugin' | 'onTogglePluginVisibility'> {\n  /**\n   * This prop accepts a list of plugins that will be shown in addition to the\n   * built-in ones (the doc explorer and the history).\n   * @default []\n   */\n  plugins?: GraphiQLPlugin[];\n\n  /**\n   * This prop can be used to set the visibility state of plugins. Every time\n   * this prop changes, the visibility state will be overridden. Note that the\n   * visibility state can change in between these updates, for example, by\n   * calling the `setVisiblePlugin` function provided by the context.\n   */\n  visiblePlugin?: GraphiQLPlugin | string;\n}\n\ntype CreatePluginSlice = (\n  initial: Pick<PluginSlice, 'onTogglePluginVisibility' | 'referencePlugin'>,\n) => StateCreator<\n  SlicesWithActions,\n  [],\n  [],\n  PluginSlice & {\n    actions: PluginActions;\n  }\n>;\n\nexport const createPluginSlice: CreatePluginSlice = initial => set => ({\n  plugins: [],\n  visiblePlugin: null,\n  ...initial,\n  actions: {\n    setVisiblePlugin(plugin = null) {\n      set(current => {\n        const {\n          visiblePlugin: currentVisiblePlugin,\n          plugins,\n          onTogglePluginVisibility,\n          storage,\n        } = current;\n        const byTitle = typeof plugin === 'string';\n        const newVisiblePlugin: PluginSlice['visiblePlugin'] =\n          (plugin && plugins.find(p => (byTitle ? p.title : p) === plugin)) ||\n          null;\n        if (newVisiblePlugin === currentVisiblePlugin) {\n          return current;\n        }\n        onTogglePluginVisibility?.(newVisiblePlugin);\n        storage.set(STORAGE_KEY.visiblePlugin, newVisiblePlugin?.title ?? '');\n        return { visiblePlugin: newVisiblePlugin };\n      });\n    },\n    setPlugins(plugins) {\n      const seenTitles = new Set<string>();\n      const msg = 'All GraphiQL plugins must have a unique title';\n      for (const { title } of plugins) {\n        if (typeof title !== 'string' || !title) {\n          throw new Error(msg);\n        }\n        if (seenTitles.has(title)) {\n          throw new Error(\n            `${msg}, found two plugins with the title '${title}'`,\n          );\n        }\n        seenTitles.add(title);\n      }\n      set({ plugins });\n    },\n  },\n});\n"],"names":["createPluginSlice","initial","set","plugins","visiblePlugin","actions","setVisiblePlugin","plugin","current","currentVisiblePlugin","onTogglePluginVisibility","storage","byTitle","newVisiblePlugin","find","p","title","STORAGE_KEY","setPlugins","seenTitles","Set","msg","Error","has","add"],"mappings":";AA6FaA,MAAAA,oBAAuCC,aAAWC,CAAQ,SAAA;AAAA,EACrEC,SAAS,CAAE;AAAA,EACXC,eAAe;AAAA,EACf,GAAGH;AAAAA,EACHI,SAAS;AAAA,IACPC,iBAAiBC,SAAS,MAAM;AAC9BL,UAAIM,CAAW,YAAA;AACP,cAAA;AAAA,UACJJ,eAAeK;AAAAA,UACfN;AAAAA,UACAO;AAAAA,UACAC;AAAAA,QAAAA,IACEH;AACEI,cAAAA,UAAU,OAAOL,WAAW;AAC5BM,cAAAA,mBACHN,UAAUJ,QAAQW,KAAKC,CAAAA,OAAMH,UAAUG,EAAEC,QAAQD,OAAOR,MAAM,KAC/D;AACF,YAAIM,qBAAqBJ,sBAAsB;AACtCD,iBAAAA;AAAAA,QAAAA;AAETE,6EAA2BG;AAC3BF,gBAAQT,IAAIe,YAAYb,gBAAeS,qDAAkBG,UAAS,EAAE;AAC7D,eAAA;AAAA,UAAEZ,eAAeS;AAAAA,QAAiB;AAAA,MAAA,CAC1C;AAAA,IACH;AAAA,IACAK,WAAWf,SAAS;AACZgB,YAAAA,iCAAiBC,IAAY;AACnC,YAAMC,MAAM;AACD,iBAAA;AAAA,QAAEL;AAAAA,WAAWb,SAAS;AAC/B,YAAI,OAAOa,UAAU,YAAY,CAACA,OAAO;AACjC,gBAAA,IAAIM,MAAMD,GAAG;AAAA,QAAA;AAEjBF,YAAAA,WAAWI,IAAIP,KAAK,GAAG;AACzB,gBAAM,IAAIM,MACR,GAAGD,GAAG,uCAAuCL,KAAK,GACpD;AAAA,QAAA;AAEFG,mBAAWK,IAAIR,KAAK;AAAA,MAAA;AAElB,UAAA;AAAA,QAAEb;AAAAA,MAAAA,CAAS;AAAA,IAAA;AAAA,EACjB;AAEJ;"}