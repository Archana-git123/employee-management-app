{"version":3,"file":"resize.js","sources":["../../src/utility/resize.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport { debounce } from './debounce';\nimport { useGraphiQL } from '../components';\n\ntype ResizableElement = 'first' | 'second';\n\ninterface UseDragResizeArgs {\n  /**\n   * Set the default sizes for the two resizable halves by passing their ratio\n   * (first divided by second).\n   * @default 1\n   */\n  defaultSizeRelation?: number;\n  /**\n   * The direction in which the two halves should be resizable.\n   */\n  direction: 'horizontal' | 'vertical';\n  /**\n   * Choose one of the two halves that should initially be hidden.\n   */\n  initiallyHidden?: ResizableElement;\n\n  /**\n   * Invoked when the visibility of one of the halves changes.\n   * @param hiddenElement - The element that is now hidden after the change\n   * (`null` if both are visible).\n   */\n  onHiddenElementChange?(hiddenElement: ResizableElement | null): void;\n\n  /**\n   * The minimum width in pixels for the first half. If it is resized to a\n   * width smaller than this threshold, the half will be hidden.\n   * @default 100\n   */\n  sizeThresholdFirst?: number;\n  /**\n   * The minimum width in pixels for the second half. If it is resized to a\n   * width smaller than this threshold, the half will be hidden.\n   * @default 100\n   */\n  sizeThresholdSecond?: number;\n  /**\n   * A key for which the state of resizing is persisted in storage (if storage\n   * is available).\n   */\n  storageKey?: string;\n}\n\nexport function useDragResize({\n  defaultSizeRelation = 1,\n  direction,\n  initiallyHidden,\n  onHiddenElementChange,\n  sizeThresholdFirst = 100,\n  sizeThresholdSecond = 100,\n  storageKey,\n}: UseDragResizeArgs) {\n  const storage = useGraphiQL(state => state.storage);\n\n  const [hiddenElement, setHiddenElement] = useState<ResizableElement | null>(\n    () => {\n      const storedValue = storageKey && storage.get(storageKey);\n      if (storedValue === HIDE_FIRST || initiallyHidden === 'first') {\n        return 'first';\n      }\n      if (storedValue === HIDE_SECOND || initiallyHidden === 'second') {\n        return 'second';\n      }\n      return null;\n    },\n  );\n\n  const firstRef = useRef<HTMLDivElement>(null);\n  const dragBarRef = useRef<HTMLDivElement>(null);\n  const secondRef = useRef<HTMLDivElement>(null);\n\n  const defaultFlexRef = useRef(`${defaultSizeRelation}`);\n\n  /**\n   * Set initial flex values\n   */\n  useEffect(() => {\n    const storedValue =\n      (storageKey && storage.get(storageKey)) || defaultFlexRef.current;\n\n    if (firstRef.current) {\n      firstRef.current.style.flex =\n        storedValue === HIDE_FIRST || storedValue === HIDE_SECOND\n          ? defaultFlexRef.current\n          : storedValue;\n    }\n\n    if (secondRef.current) {\n      secondRef.current.style.flex = '1';\n    }\n  }, [direction, storage, storageKey]);\n\n  /**\n   * Hide and show items when the state changes\n   */\n  useEffect(() => {\n    function hide(element: HTMLDivElement) {\n      element.style.left = '-1000px';\n      element.style.position = 'absolute';\n      element.style.opacity = '0';\n\n      // Make sure that the flex value of the first item is at least equal to one\n      // so that the entire space of the parent element is filled up\n      if (!firstRef.current) {\n        return;\n      }\n      const flex = parseFloat(firstRef.current.style.flex);\n      if (!Number.isFinite(flex) || flex < 1) {\n        firstRef.current.style.flex = '1';\n      }\n    }\n\n    function show(element: HTMLDivElement) {\n      element.style.left = '';\n      element.style.position = '';\n      element.style.opacity = '';\n\n      if (!storageKey) {\n        return;\n      }\n      const storedValue = storage.get(storageKey);\n      if (\n        firstRef.current &&\n        storedValue !== HIDE_FIRST &&\n        storedValue !== HIDE_SECOND\n      ) {\n        firstRef.current.style.flex = storedValue || defaultFlexRef.current;\n      }\n    }\n\n    for (const id of ['first', 'second'] as const) {\n      const element = (id === 'first' ? firstRef : secondRef).current;\n      if (element) {\n        if (id === hiddenElement) {\n          hide(element);\n        } else {\n          show(element);\n        }\n      }\n    }\n  }, [hiddenElement, storage, storageKey]);\n\n  useEffect(() => {\n    if (!dragBarRef.current || !firstRef.current || !secondRef.current) {\n      return;\n    }\n    const store = debounce(500, (value: string) => {\n      if (storageKey) {\n        storage.set(storageKey, value);\n      }\n    });\n\n    function setHiddenElementWithCallback(element: ResizableElement | null) {\n      setHiddenElement(prevHiddenElement => {\n        if (element === prevHiddenElement) {\n          return prevHiddenElement;\n        }\n        onHiddenElementChange?.(element);\n        return element;\n      });\n    }\n\n    const dragBarContainer = dragBarRef.current;\n    const firstContainer = firstRef.current;\n    const wrapper = firstContainer.parentElement!;\n    const isHorizontal = direction === 'horizontal';\n    const eventProperty = isHorizontal ? 'clientX' : 'clientY';\n    const rectProperty = isHorizontal ? 'left' : 'top';\n    const adjacentRectProperty = isHorizontal ? 'right' : 'bottom';\n    const sizeProperty = isHorizontal ? 'clientWidth' : 'clientHeight';\n\n    function handleMouseDown(downEvent: MouseEvent) {\n      const isClickOnCurrentElement =\n        downEvent.target === downEvent.currentTarget;\n      if (!isClickOnCurrentElement) {\n        return;\n      }\n\n      downEvent.preventDefault();\n\n      // Distance between the start of the drag bar and the exact point where\n      // the user clicked on the drag bar.\n      const offset =\n        downEvent[eventProperty] -\n        dragBarContainer.getBoundingClientRect()[rectProperty];\n\n      function handleMouseMove(moveEvent: MouseEvent) {\n        if (moveEvent.buttons === 0) {\n          return handleMouseUp();\n        }\n        const domRect = wrapper.getBoundingClientRect();\n        const firstSize =\n          moveEvent[eventProperty] - domRect[rectProperty] - offset;\n        const secondSize =\n          domRect[adjacentRectProperty] -\n          moveEvent[eventProperty] +\n          offset -\n          dragBarContainer[sizeProperty];\n\n        if (firstSize < sizeThresholdFirst) {\n          // Hide the first display\n          setHiddenElementWithCallback('first');\n          store(HIDE_FIRST);\n        } else if (secondSize < sizeThresholdSecond) {\n          // Hide the second display\n          setHiddenElementWithCallback('second');\n          store(HIDE_SECOND);\n        } else {\n          // Show both and adjust the flex value of the first one (the flex\n          // value for the second one is always `1`)\n          setHiddenElementWithCallback(null);\n          const newFlex = `${firstSize / secondSize}`;\n          firstContainer.style.flex = newFlex;\n          store(newFlex);\n        }\n      }\n\n      function handleMouseUp() {\n        document.removeEventListener('mousemove', handleMouseMove);\n        document.removeEventListener('mouseup', handleMouseUp);\n      }\n\n      document.addEventListener('mousemove', handleMouseMove);\n      document.addEventListener('mouseup', handleMouseUp);\n    }\n\n    dragBarContainer.addEventListener('mousedown', handleMouseDown);\n\n    function reset() {\n      if (firstRef.current) {\n        firstRef.current.style.flex = defaultFlexRef.current;\n      }\n      store(defaultFlexRef.current);\n      setHiddenElementWithCallback(null);\n    }\n\n    dragBarContainer.addEventListener('dblclick', reset);\n\n    return () => {\n      dragBarContainer.removeEventListener('mousedown', handleMouseDown);\n      dragBarContainer.removeEventListener('dblclick', reset);\n    };\n  }, [\n    direction,\n    onHiddenElementChange,\n    sizeThresholdFirst,\n    sizeThresholdSecond,\n    storage,\n    storageKey,\n  ]);\n\n  return {\n    dragBarRef,\n    hiddenElement,\n    firstRef,\n    setHiddenElement,\n    secondRef,\n  };\n}\n\nconst HIDE_FIRST = 'hide-first';\nconst HIDE_SECOND = 'hide-second';\n"],"names":["useDragResize","t0","$","_c","defaultSizeRelation","t1","direction","initiallyHidden","onHiddenElementChange","sizeThresholdFirst","t2","sizeThresholdSecond","t3","storageKey","undefined","storage","useGraphiQL","_temp","t4","storedValue","get","HIDE_FIRST","HIDE_SECOND","hiddenElement","setHiddenElement","useState","firstRef","useRef","dragBarRef","secondRef","defaultFlexRef","t5","storedValue_0","current","style","flex","t6","useEffect","t7","t8","hide","element","left","position","opacity","parseFloat","Number","isFinite","show","element_0","storedValue_1","id","element_1","t10","t9","store","debounce","value","set","setHiddenElementWithCallback","element_2","prevHiddenElement","dragBarContainer","firstContainer","wrapper","parentElement","isHorizontal","eventProperty","rectProperty","adjacentRectProperty","sizeProperty","handleMouseDown","downEvent","isClickOnCurrentElement","target","currentTarget","preventDefault","offset","getBoundingClientRect","handleMouseMove","moveEvent","buttons","handleMouseUp","domRect","firstSize","secondSize","newFlex","removeEventListener","addEventListener","reset","t11","state"],"mappings":"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"}