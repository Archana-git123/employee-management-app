{"version":3,"file":"context.js","sources":["../src/context.ts"],"sourcesContent":["import { FC, ReactElement, ReactNode, useEffect } from 'react';\nimport { createStore } from 'zustand';\nimport {\n  HistoryStore as ToolkitHistoryStore,\n  QueryStoreItem,\n} from '@graphiql/toolkit';\nimport { useGraphiQL, pick, createBoundedUseStore } from '@graphiql/react';\n\nconst historyStore = createStore<HistoryStoreType>((set, get) => ({\n  historyStorage: null,\n  actions: {\n    addToHistory(operation) {\n      const { historyStorage } = get();\n      historyStorage?.updateHistory(operation);\n      set({}); // trigger rerender\n    },\n    editLabel(operation, index) {\n      const { historyStorage } = get();\n      historyStorage?.editLabel(operation, index);\n      set({}); // trigger rerender\n    },\n    toggleFavorite(operation) {\n      const { historyStorage } = get();\n      historyStorage?.toggleFavorite(operation);\n      set({}); // trigger rerender\n    },\n    setActive: item => item,\n    deleteFromHistory(item, clearFavorites) {\n      const { historyStorage } = get();\n      historyStorage?.deleteHistory(item, clearFavorites);\n      set({}); // trigger rerender\n    },\n  },\n}));\n\ntype HistoryStoreType = {\n  // Can be `null` if History plugin saved in `localStorage` as `visiblePlugin`\n  historyStorage: ToolkitHistoryStore | null;\n  actions: {\n    /**\n     * Add an operation to the history.\n     * @param operation The operation that was executed, consisting of the query,\n     * variables, headers, and operation name.\n     */\n    addToHistory(operation: {\n      query?: string;\n      variables?: string;\n      headers?: string;\n      operationName?: string;\n    }): void;\n    /**\n     * Change the custom label of an item from the history.\n     * @param args An object containing the label (`undefined` if it should be\n     * unset) and properties that identify the history item that the label should\n     * be applied to. (This can result in the label being applied to multiple\n     * history items.)\n     * @param index Index to edit. Without it, will look for the first index matching the\n     * operation, which may lead to misleading results if multiple items have the same label\n     */\n    editLabel(\n      args: {\n        query?: string;\n        variables?: string;\n        headers?: string;\n        operationName?: string;\n        label?: string;\n        favorite?: boolean;\n      },\n      index?: number,\n    ): void;\n    /**\n     * Toggle the favorite state of an item from the history.\n     * @param args An object containing the favorite state (`undefined` if it\n     * should be unset) and properties that identify the history item that the\n     * label should be applied to. (This can result in the label being applied\n     * to multiple history items.)\n     */\n    toggleFavorite(args: {\n      query?: string;\n      variables?: string;\n      headers?: string;\n      operationName?: string;\n      label?: string;\n      favorite?: boolean;\n    }): void;\n    /**\n     * Delete an operation from the history.\n     * @param args The operation that was executed, consisting of the query,\n     * variables, headers, and operation name.\n     * @param clearFavorites This is only if you press the 'clear' button\n     */\n    deleteFromHistory(args: QueryStoreItem, clearFavorites?: boolean): void;\n    /**\n     * If you need to know when an item in history is set as active to customize\n     * your application.\n     */\n    setActive(args: QueryStoreItem): void;\n  };\n};\n\ntype HistoryStoreProps = {\n  children: ReactNode;\n  /**\n   * The maximum number of executed operations to store.\n   * @default 20\n   */\n  maxHistoryLength?: number;\n};\n\n/**\n * The functions send the entire operation so users can customize their own application and get\n * access to the operation plus any additional props they added for their needs (i.e., build their\n * own functions that may save to a backend instead of localStorage and might need an id property\n * added to the `QueryStoreItem`)\n */\nexport const HistoryStore: FC<HistoryStoreProps> = ({\n  maxHistoryLength = 20,\n  children,\n}) => {\n  const { isFetching, tabs, activeTabIndex, storage } = useGraphiQL(\n    pick('isFetching', 'tabs', 'activeTabIndex', 'storage'),\n  );\n  const activeTab = tabs[activeTabIndex]!;\n  const historyStorage = // eslint-disable-line react-hooks/exhaustive-deps -- false positive, code is optimized by React Compiler\n    new ToolkitHistoryStore(storage, maxHistoryLength);\n\n  useEffect(() => {\n    historyStore.setState({ historyStorage });\n  }, [historyStorage]);\n\n  useEffect(() => {\n    if (!isFetching) {\n      return;\n    }\n    const { addToHistory } = historyStore.getState().actions;\n    addToHistory({\n      query: activeTab.query ?? undefined,\n      variables: activeTab.variables ?? undefined,\n      headers: activeTab.headers ?? undefined,\n      operationName: activeTab.operationName ?? undefined,\n    });\n  }, [isFetching, activeTab]);\n\n  return children as ReactElement;\n};\n\nconst useHistoryStore = createBoundedUseStore(historyStore);\n\nconst EMPTY_ARRAY: QueryStoreItem[] = [];\n\nexport const useHistory = () =>\n  useHistoryStore(state => state.historyStorage?.queries ?? EMPTY_ARRAY);\n\n/**\n * Actions are functions used to update values in your store. They are static and never change.\n * @see https://tkdodo.eu/blog/working-with-zustand#separate-actions-from-state\n */\nexport const useHistoryActions = () => useHistoryStore(state => state.actions);\n"],"names":["historyStore","createStore","set","get","historyStorage","actions","addToHistory","operation","updateHistory","editLabel","index","toggleFavorite","setActive","item","deleteFromHistory","clearFavorites","deleteHistory","HistoryStore","t0","$","_c","maxHistoryLength","t1","children","undefined","t2","Symbol","for","pick","isFetching","tabs","activeTabIndex","storage","useGraphiQL","activeTab","t3","ToolkitHistoryStore","t4","t5","setState","useEffect","t6","t7","getState","query","variables","headers","operationName","useHistoryStore","createBoundedUseStore","EMPTY_ARRAY","useHistory","_temp","useHistoryActions","_temp2","state","queries"],"mappings":"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"}